import{g as l,a as g,k as e,s as A,u as N,l as x,h as T,d as M,r as D,a6 as G,o as K,a7 as Q,f as F,p as b,q as y,b as a,a8 as W,z as X,e as k,K as I,N as L,O,I as Y,U as j,V as z,_ as H,j as de,F as q,x as J,t as E,J as R}from"./index.2e401dab.js";import{P as oe}from"./PUserLayout.0d700a5d.js";import{I as P,g as Z}from"./getPaymentByType.f6787bda.js";const ie={class:"svg-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},se=e("path",{fill:"currentColor",d:"M11 19v-6H5v-2h6V5h2v6h6v2h-6v6h-2Z"},null,-1),re=[se];function le(t,m){return l(),g("svg",ie,re)}const ce={name:"material-symbols-add",render:le};function ee(t){const{isMocked:m,mockData:i}=A(N()),{isUserTokenValid:u}=N(),{userId:r,userToken:_}=A(x()),{forcedLogout:C}=x();if(!m.value)return T.post({url:"/payment",data:t});if(u(_.value)===!1){C();return}if(i.value==null)return;const s=i.value.payment,p=s.length>0?s[s.length-1].id+1:1;s.push({id:p,userId:r.value,...t})}function te(t){const{isMocked:m,mockData:i}=A(N()),{isUserTokenValid:u}=N(),{userToken:r}=A(x()),{forcedLogout:_}=x();if(!m.value)return T.patch({url:`/payment/${t.id}`,data:t});if(u(r.value)===!1){_();return}if(i.value==null)return;const s=i.value.payment.find(p=>p.id===t.id);s.cardNumber!==""?(s.cardNumber=t.cardNumber,s.cardOwner=t.cardOwner,s.cardValidDate=t.cardValidDate,s.cardValidCode=t.cardValidCode):s.bankCode!==""&&(s.bankCode=t.bankCode,s.bankAccount=t.bankAccount)}function ae({id:t}){const{isMocked:m,mockData:i}=A(N()),{isUserTokenValid:u}=N(),{userToken:r}=A(x()),{forcedLogout:_}=x();if(!m.value)return T.delete({url:`/payment/${t}`});if(u(r.value)===!1){_();return}if(i.value==null)return;const C=i.value.payment,s=C.findIndex(p=>p.id===t);s!==-1&&C.splice(s,1)}const U=t=>(j("data-v-c09b09bc"),t=t(),z(),t),me={class:"mask"},ve={key:0,class:"title"},be=U(()=>e("div",null,"\u65B0\u589E\u4FE1\u7528\u5361\uFF0F\u91D1\u878D\u5361",-1)),pe={key:1,class:"title"},Ce=U(()=>e("div",null,"\u7DE8\u8F2F\u4FE1\u7528\u5361\uFF0F\u91D1\u878D\u5361",-1)),_e={class:"form-container"},ke={class:"inputs-container"},ye=U(()=>e("div",{class:"sub-title"}," \u5361\u865F ",-1)),fe=U(()=>e("div",{class:"sub-title"}," \u6301\u5361\u4EBA\u59D3\u540D ",-1)),ge=U(()=>e("div",{class:"sub-title"}," \u6709\u6548\u671F ",-1)),Fe=U(()=>e("div",{class:"sub-title"}," \u5B89\u5168\u78BC ",-1)),De={class:"btn-container"},Be=M({__name:"AddCreditCardDialog",props:{target:{type:String,required:!0},currentCreditCardData:{type:[Object],required:!0}},emits:["closeDialog","updatePaymentList"],setup(t,{emit:m}){const i=t,u=D(i.currentCreditCardData);function r(){m("closeDialog")}const _={text:"\u52A0\u5165",color:"main-product-color"},C={text:"\u5B8C\u6210",color:"main-product-color"},s={text:"\u522A\u9664",color:"main-color"};window.addEventListener("keydown",c=>{c.code==="Escape"&&r()},!1);const p=G(window.document.body);K(()=>{p.value=!0}),Q(()=>{p.value=!1});async function f(){const c=i.currentCreditCardData;c!=null&&await ee({type:"credit-card",cardNumber:c.cardNumber,cardOwner:c.cardOwner,cardValidCode:c.cardValidCode,cardValidDate:c.cardValidDate,bankCode:"",bankAccount:""})}async function h(){i.currentCreditCardData!=null&&await te({...i.currentCreditCardData,bankCode:"",bankAccount:""})}function $(){i.target==="add"?f():h(),m("updatePaymentList"),r()}async function w(){await ae({id:i.currentCreditCardData.id}),m("updatePaymentList"),r()}return(c,n)=>{const o=Y("FormKit");return l(),F(X,{to:"body"},[e("div",me,[b(a(W),{class:"container",onTrigger:r},{default:y(()=>[t.target==="add"?(l(),g("div",ve,[be,e("button",{onClick:r},[b(a(P))])])):k("",!0),t.target==="edit"?(l(),g("div",pe,[Ce,e("button",{onClick:r},[b(a(P))])])):k("",!0),e("div",_e,[b(o,{type:"form",actions:!1,"incomplete-message":" ",onSubmit:$,onSubmitInvalid:n[8]||(n[8]=()=>{})},{default:y(()=>[e("div",ke,[b(o,{modelValue:a(u).cardNumber,"onUpdate:modelValue":n[1]||(n[1]=d=>a(u).cardNumber=d),type:"text",validation:"required|number|length:16, 16","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165",number:"\u8ACB\u8F38\u5165\u6578\u5B57",length:"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u5361\u865F"}},{wrapper:y(()=>[ye,I(e("input",{"onUpdate:modelValue":n[0]||(n[0]=d=>a(u).cardNumber=d),type:"text"},null,512),[[L,a(u).cardNumber]])]),_:1},8,["modelValue"]),b(o,{modelValue:a(u).cardOwner,"onUpdate:modelValue":n[3]||(n[3]=d=>a(u).cardOwner=d),type:"text",validation:"required:trim","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165"}},{wrapper:y(()=>[fe,I(e("input",{"onUpdate:modelValue":n[2]||(n[2]=d=>a(u).cardOwner=d),type:"text"},null,512),[[L,a(u).cardOwner]])]),_:1},8,["modelValue"]),b(o,{modelValue:a(u).cardValidDate,"onUpdate:modelValue":n[5]||(n[5]=d=>a(u).cardValidDate=d),type:"text",validation:"required:trim|matches:/^([0-9]{2})\\/([0-9]{2})$/","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165",matches:"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u65E5\u671F"}},{wrapper:y(()=>[ge,I(e("input",{"onUpdate:modelValue":n[4]||(n[4]=d=>a(u).cardValidDate=d),type:"text"},null,512),[[L,a(u).cardValidDate]])]),_:1},8,["modelValue"]),b(o,{modelValue:a(u).cardValidCode,"onUpdate:modelValue":n[7]||(n[7]=d=>a(u).cardValidCode=d),type:"text",validation:"required:trim|number|length:3, 3","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165",number:"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u5B89\u5168\u78BC",length:"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u5B89\u5168\u78BC"}},{wrapper:y(()=>[Fe,I(e("input",{"onUpdate:modelValue":n[6]||(n[6]=d=>a(u).cardValidCode=d),type:"text"},null,512),[[L,a(u).cardValidCode]])]),_:1},8,["modelValue"])]),e("div",De,[t.target==="add"?(l(),F(O,{key:0,content:_,type:"submit"})):k("",!0),t.target==="edit"?(l(),F(O,{key:1,content:s,type:"button",onClick:w})):k("",!0),t.target==="edit"?(l(),F(O,{key:2,content:C,type:"submit"})):k("",!0)])]),_:1})])]),_:1})])])}}});const Ve=H(Be,[["__scopeId","data-v-c09b09bc"]]),S=t=>(j("data-v-82187a9e"),t=t(),z(),t),he={class:"mask"},we={key:0,class:"title"},Ae=S(()=>e("div",null,"\u65B0\u589E\u9280\u884C\u5E33\u865F",-1)),xe={key:1,class:"title"},$e=S(()=>e("div",null,"\u7DE8\u8F2F\u9280\u884C\u5E33\u865F",-1)),Ee={class:"form-container"},Ie={class:"inputs-container"},Le=S(()=>e("div",{class:"sub-title"}," \u9280\u884C\u4EE3\u78BC ",-1)),Oe=S(()=>e("div",{class:"sub-title"}," \u9280\u884C\u5E33\u865F ",-1)),Ne={class:"btn-container"},Ue=M({__name:"AddBankDialog",props:{target:{type:String,required:!0},currentBankData:{type:[Object],required:!0}},emits:["closeDialog","updatePaymentList"],setup(t,{emit:m}){const i=t,u=D(i.currentBankData);function r(){m("closeDialog")}const _={text:"\u52A0\u5165",color:"main-product-color"},C={text:"\u5B8C\u6210",color:"main-product-color"},s={text:"\u522A\u9664",color:"main-color"};window.addEventListener("keydown",c=>{c.code==="Escape"&&r()},!1);const p=G(window.document.body);K(()=>{p.value=!0}),Q(()=>{p.value=!1});async function f(){const c=i.currentBankData;c!=null&&await ee({type:"transfer",cardNumber:"",cardOwner:"",cardValidCode:"",cardValidDate:"",bankCode:c.bankCode,bankAccount:c.bankAccount})}async function h(){i.currentBankData!=null&&await te({cardNumber:"",cardOwner:"",cardValidCode:"",cardValidDate:"",...i.currentBankData})}function $(){i.target==="add"?f():h(),m("updatePaymentList"),r()}async function w(){await ae({id:i.currentBankData.id}),m("updatePaymentList"),r()}return(c,n)=>{const o=Y("FormKit");return l(),F(X,{to:"body"},[e("div",he,[b(a(W),{class:"container",onTrigger:r},{default:y(()=>[t.target==="add"?(l(),g("div",we,[Ae,e("button",{onClick:r},[b(a(P))])])):k("",!0),t.target==="edit"?(l(),g("div",xe,[$e,e("button",{onClick:r},[b(a(P))])])):k("",!0),e("div",Ee,[b(o,{type:"form",actions:!1,"incomplete-message":" ",onSubmit:$,onSubmitInvalid:n[4]||(n[4]=()=>{})},{default:y(()=>[e("div",Ie,[b(o,{modelValue:a(u).bankCode,"onUpdate:modelValue":n[1]||(n[1]=d=>a(u).bankCode=d),type:"text",validation:"required|number|length:3, 3","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165",number:"\u8ACB\u8F38\u5165\u6578\u5B57",length:"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u9280\u884C\u4EE3\u78BC"}},{wrapper:y(()=>[Le,I(e("input",{"onUpdate:modelValue":n[0]||(n[0]=d=>a(u).bankCode=d),type:"text"},null,512),[[L,a(u).bankCode]])]),_:1},8,["modelValue"]),b(o,{modelValue:a(u).bankAccount,"onUpdate:modelValue":n[3]||(n[3]=d=>a(u).bankAccount=d),type:"text",validation:"required:trim|number|length:10, 14","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165",number:"\u8ACB\u8F38\u5165\u6578\u5B57",length:"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u5361\u865F"}},{wrapper:y(()=>[Oe,I(e("input",{"onUpdate:modelValue":n[2]||(n[2]=d=>a(u).bankAccount=d),type:"text"},null,512),[[L,a(u).bankAccount]])]),_:1},8,["modelValue"])]),e("div",Ne,[t.target==="add"?(l(),F(O,{key:0,content:_,type:"submit"})):k("",!0),t.target==="edit"?(l(),F(O,{key:1,content:s,type:"button",onClick:w})):k("",!0),t.target==="edit"?(l(),F(O,{key:2,content:C,type:"submit"})):k("",!0)])]),_:1})])]),_:1})])])}}});const Pe=H(Ue,[["__scopeId","data-v-82187a9e"]]),ne=t=>(j("data-v-bb5cc55f"),t=t(),z(),t),Se={class:"payment-container"},qe={class:"main-block"},Te={class:"credit-card-block block"},Me=ne(()=>e("div",{class:"subtitle"}," \u4FE1\u7528\u5361\uFF0F\u91D1\u878D\u5361 ",-1)),Ke={class:"credit-card-content content"},je=["onClick"],ze={class:"item-name"},He={class:"item-number"},Je={class:"add-btn-container"},Re={class:"bank-block block"},Ze=ne(()=>e("div",{class:"subtitle"}," \u9280\u884C\u5E33\u865F ",-1)),Ge={class:"bank-content content"},Qe=["onClick"],We={class:"item-name"},Xe={class:"item-number"},Ye={class:"add-btn-container"},et=M({__name:"Payment",setup(t){const{userId:m}=A(x()),{startLoading:i,endLoading:u}=de(),r=D(),_=D();async function C(){i(),r.value=(await Z({userId:m.value,type:"credit-card"})).data,_.value=(await Z({userId:m.value,type:"transfer"})).data,u()}K(()=>{C()});const s=D(!1),p=D(!1),f=D(),h=D({id:-1,cardNumber:"",cardOwner:"",cardValidDate:"",cardValidCode:""});function $(n,o){var d,v,B,V;s.value=!0,f.value=n,n==="add"?h.value={id:-1,cardNumber:"",cardOwner:"",cardValidDate:"",cardValidCode:""}:n==="edit"&&o&&(h.value={id:o.id,cardNumber:(d=o.cardNumber)!=null?d:"",cardOwner:(v=o.cardOwner)!=null?v:"",cardValidDate:(B=o.cardValidDate)!=null?B:"",cardValidCode:(V=o.cardValidCode)!=null?V:""})}const w=D({id:-1,bankCode:"",bankAccount:""});function c(n,o){var d,v;p.value=!0,f.value=n,n==="add"?w.value={id:-1,bankCode:"",bankAccount:""}:n==="edit"&&o&&(w.value={id:o.id,bankCode:(d=o.bankCode)!=null?d:"",bankAccount:(v=o.bankAccount)!=null?v:""})}return(n,o)=>{const d=ce;return l(),g(q,null,[b(oe,null,{default:y(()=>[e("div",Se,[e("div",qe,[e("div",Te,[Me,e("div",Ke,[(l(!0),g(q,null,J(a(r),(v,B)=>{var V;return l(),g("div",{key:`card-${B+1}`,class:"item",onClick:ue=>$("edit",v)},[e("div",null,"\uFF08"+E(B+1)+"\uFF09",1),e("div",ze,E(v.cardOwner),1),e("div",He," *"+E((V=v.cardNumber)==null?void 0:V.slice(-4)),1)],8,je)}),128)),e("div",Je,[e("button",{class:"add-btn",onClick:o[0]||(o[0]=v=>$("add"))},[b(d),R("\u65B0\u589E\u4FE1\u7528\u5361 ")])])])]),e("div",Re,[Ze,e("div",Ge,[(l(!0),g(q,null,J(a(_),(v,B)=>{var V;return l(),g("div",{key:`account-${B+1}`,class:"item",onClick:ue=>c("edit",v)},[e("div",null,"\uFF08"+E(B+1)+"\uFF09",1),e("div",We,E(v.bankCode),1),e("div",Xe," *"+E((V=v.bankAccount)==null?void 0:V.slice(-4)),1)],8,Qe)}),128)),e("div",Ye,[e("button",{class:"add-btn",onClick:o[1]||(o[1]=v=>c("add"))},[b(d),R("\u65B0\u589E\u9280\u884C\u5E33\u865F ")])])])])])])]),_:1}),a(s)&&a(f)?(l(),F(Ve,{key:0,target:a(f),"current-credit-card-data":a(h),onCloseDialog:o[2]||(o[2]=v=>s.value=!1),onUpdatePaymentList:C},null,8,["target","current-credit-card-data"])):k("",!0),a(p)&&a(f)?(l(),F(Pe,{key:1,target:a(f),"current-bank-data":a(w),onCloseDialog:o[3]||(o[3]=v=>p.value=!1),onUpdatePaymentList:C},null,8,["target","current-bank-data"])):k("",!0)],64)}}});const ut=H(et,[["__scopeId","data-v-bb5cc55f"]]);export{ut as default};
