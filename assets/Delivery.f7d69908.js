import{g as l,a as r,k as a,d as ue,s as R,l as J,a6 as re,o as ae,a7 as ce,r as E,f as P,p as n,q as p,b as t,a8 as pe,z as W,e as y,x as oe,t as V,F as X,_ as ne,u as Z,h as me,n as ve,H as M,T as z,B as ye,D as _e,C as be,K as s,a9 as g,L as K,J as H,a2 as G,N as T,ab as Fe,O as fe,Q as ee,I as Ce,U as ge,V as he}from"./index.2e401dab.js";import{g as te,I as Be}from"./getPaymentByType.f6787bda.js";import{P as ke}from"./PCheckoutLayout.2241f34a.js";import{I as De,a as Ee}from"./cross-circle.b92b233f.js";import{u as Ve}from"./orderData.60432e96.js";import{g as Ae}from"./getProductListFromShoppingCartByUserId.c011d6c8.js";import{d as xe}from"./deleteProductFromCart.dd467e27.js";import"./getProductListFromBoughtByOrderId.3e1bc5f5.js";const Ie={class:"svg-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Te=a("path",{fill:"currentColor",d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5s5-2.24 5-5s-2.24-5-5-5zm0-5C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8s8 3.58 8 8s-3.58 8-8 8z"},null,-1),we=[Te];function Se(_,e){return l(),r("svg",Ie,we)}const $e={name:"ic-baseline-radio-button-checked",render:Se},Ue={class:"svg-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Pe=a("path",{fill:"currentColor",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8s8 3.58 8 8s-3.58 8-8 8z"},null,-1),qe=[Pe];function Le(_,e){return l(),r("svg",Ue,qe)}const Ne={name:"ic-baseline-radio-button-unchecked",render:Le},Oe={class:"mask"},Me={class:"title-container"},ze={key:0,class:"title"},Ke={key:1,class:"title"},He={class:"payment-container"},Re={key:0,class:"payment-titles"},Ye={key:1,class:"payment-titles"},Je=["onClick"],Qe={key:0},je={key:1},Ge={key:2},We={key:3},Xe=ue({__name:"PaymentSelect",props:{target:{type:String,required:!0}},emits:["closeDialog"],setup(_,{emit:e}){const b=_,{userId:w}=R(J());window.addEventListener("keydown",F=>{F.code==="Escape"&&B()},!1);const S=re(window.document.body);ae(()=>{q(),S.value=!0}),ce(()=>{S.value=!1});function B(){e("closeDialog")}const A=E([]);async function q(){b.target==="credit-card"?A.value=(await te({userId:w.value,type:"credit-card"})).data:b.target==="transfer"&&(A.value=(await te({userId:w.value,type:"transfer"})).data)}function h(F){e("closeDialog",F)}return(F,C)=>(l(),P(W,{to:"body"},[a("div",Oe,[n(t(pe),{class:"container",onTrigger:B},{default:p(()=>[a("div",Me,[b.target==="credit-card"?(l(),r("div",ze," \u4FE1\u7528\u5361 ")):b.target==="transfer"?(l(),r("div",Ke," \u9280\u884C\u8F49\u5E33 ")):y("",!0),a("button",{onClick:B},[n(t(Be))])]),a("div",He,[b.target==="credit-card"?(l(),r("div",Re," \u7DE8\u865F \uFF0F \u6301\u5361\u4EBA\u59D3\u540D \uFF0F \u5361\u865F\u672B\u56DB\u78BC ")):b.target==="transfer"?(l(),r("div",Ye," \u7DE8\u865F \uFF0F \u9280\u884C\u4EE3\u78BC \uFF0F \u5E33\u865F\u672B\u56DB\u78BC ")):y("",!0),(l(!0),r(X,null,oe(t(A),(i,k)=>(l(),r("button",{key:`payment-${k}`,class:"payment-btn",onClick:D=>h(i)},[a("div",null," \uFF08"+V(k+1)+"\uFF09 ",1),i.cardOwner!==""?(l(),r("div",Qe,V(i.cardOwner),1)):y("",!0),i.cardNumber!==""?(l(),r("div",je," *"+V(i.cardNumber.slice(-4)),1)):y("",!0),i.bankCode!==""?(l(),r("div",Ge,V(i.bankCode),1)):y("",!0),i.bankAccount!==""?(l(),r("div",We," *"+V(i.bankAccount.slice(-4)),1)):y("",!0)],8,Je))),128))])]),_:1})])]))}});const Ze=ne(Xe,[["__scopeId","data-v-2bdb7939"]]),et={class:"svg-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},tt=a("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16zm-3.5-6H14a.5.5 0 1 0 0-1h-4a2.5 2.5 0 1 1 0-5h1V6h2v2h2.5v2H10a.5.5 0 1 0 0 1h4a2.5 2.5 0 1 1 0 5h-1v2h-2v-2H8.5v-2z"},null,-1),ut=[tt];function at(_,e){return l(),r("svg",et,ut)}const ot={name:"ri-money-dollar-circle-line",render:at};function nt(_){const{isMocked:e,mockData:b}=R(Z()),{getTimeStamp:w,isUserTokenValid:S}=Z(),{userId:B,userToken:A}=R(J()),{forcedLogout:q}=J();if(!e.value)return me.post({url:"/orders",data:_});if(S(A.value)===!1)return q(),{data:{}};if(b.value==null)return{data:{}};const{orderData:h,boughtItems:F}=_,C=b.value.orders,i=b.value.boughtItems,k=w(),D=F.reduce((x,$)=>x+$.amount,0),L=F.reduce((x,$)=>x+$.price*$.amount,0),Q=C.length>0?C[C.length-1].id+1:1;let j=i.length>0?i[i.length-1].id:0;const m={id:Q,userId:B.value,serialNumber:`${Date.now()}`,status:"prepared",paymentStatus:h.paymentType==="cash-on-delivery"?"unpaid":"paid",totalAmount:D,totalPrice:L,deleted:!1,purchaseTime:k,...h};C.push(m);const N=F.map(x=>({id:++j,userId:B.value,orderId:m.serialNumber,purchaseTime:k,deleted:!1,...x}));return i.push(...N),{data:{serialNumber:m.serialNumber,status:m.status,name:m.name,mobile:m.mobile,email:m.email,county:m.county,address:m.address,paymentStatus:m.paymentStatus,boughtItems:N,totalAmount:m.totalAmount,totalPrice:m.totalPrice}}}const f=_=>(ge("data-v-a42543a9"),_=_(),he(),_),lt={class:"container"},st={class:"detail"},it={class:"data-container"},dt={class:"payment-container"},rt=f(()=>a("div",{class:"title"}," \u4ED8\u6B3E\u65B9\u5F0F ",-1)),ct={class:"payment-block block"},pt={class:"sub-title"},mt={class:"credit-input-block"},vt=f(()=>a("div",{class:"credit-title"}," \u5361\u865F ",-1)),yt={class:"credit-input-block"},_t=f(()=>a("div",{class:"credit-title"}," \u6301\u5361\u4EBA\u59D3\u540D ",-1)),bt={class:"credit-input-block"},Ft=f(()=>a("div",{class:"credit-title"}," \u6709\u6548\u671F ",-1)),ft={class:"credit-input-block"},Ct=f(()=>a("div",{class:"credit-title"}," \u5B89\u5168\u78BC ",-1)),gt={class:"sub-title"},ht={class:"transfer-input-block"},Bt=f(()=>a("div",{class:"transfer-title"}," \u9280\u884C\u4EE3\u78BC ",-1)),kt={class:"transfer-input-block"},Dt=f(()=>a("div",{class:"transfer-title"}," \u5E33\u6236\u865F\u78BC ",-1)),Et={class:"sub-title"},Vt={class:"delivery-container"},At=f(()=>a("div",{class:"title"}," \u6536\u4EF6\u8CC7\u6599 ",-1)),xt={class:"block"},It={class:"sub-title"},Tt=f(()=>a("option",{value:null}," \u7E23\u5E02 ",-1)),wt=["value"],St={class:"sub-title"},$t={key:0,class:"sub-content convience-block"},Ut=f(()=>a("button",{type:"button",class:"select-btn"}," \u9078\u53D6\u8D85\u5546 ",-1)),Pt=f(()=>a("span",{class:"select-status"},"\u5C1A\u672A\u9078\u53D6\u8D85\u5546",-1)),qt=[Ut,Pt],Lt={class:"complete-btn"},Nt=ue({__name:"Delivery",setup(_){const{orderData:e}=R(Ve()),{userId:b}=R(J()),{emit:w}=ve(),S={text:"\u78BA\u8A8D\u4ED8\u6B3E",color:"main-product-color",afterTextIcon:ot},B=["\u53F0\u5317\u5E02","\u65B0\u5317\u5E02","\u6843\u5712\u5E02","\u53F0\u4E2D\u5E02","\u53F0\u5357\u5E02","\u9AD8\u96C4\u5E02","\u57FA\u9686\u5E02","\u65B0\u7AF9\u5E02","\u5609\u7FA9\u5E02","\u65B0\u7AF9\u7E23","\u82D7\u6817\u7E23","\u5F70\u5316\u7E23","\u5357\u6295\u7E23","\u96F2\u6797\u7E23","\u5609\u7FA9\u7E23","\u5C4F\u6771\u7E23","\u5B9C\u862D\u7E23","\u82B1\u84EE\u7E23","\u53F0\u6771\u7E23","\u6F8E\u6E56\u7E23","\u91D1\u9580\u7E23","\u9023\u6C5F\u7E23"],A=[{label:"\u4FE1\u7528\u5361\uFF0F\u91D1\u878D\u5361",value:"credit-card"},{label:"\u9280\u884C\u8F49\u5E33",value:"transfer"},{label:"\u8CA8\u5230\u4ED8\u6B3E",value:"cash-on-delivery"}],q=[{label:"\u5B85\u914D",value:"home-delivery"},{label:"\u8D85\u5546\u53D6\u8CA8",value:"convenience-store"}],h=E(!1),F=E(!0),C=E(!1),i=E("credit-card"),k=E(),D=E(),L=E();async function Q(){D.value=(await Ae({userId:b.value})).data}async function j(){D.value!=null&&(L.value=await Promise.all(D.value.map(async d=>{const u=(await ye({id:d.productId})).data,I=(await _e({productId:d.productId})).data,v=(await be({productId:d.productId})).data.find(Y=>Y.id===d.specificationId);return{productId:d.productId,name:u.name,image:I[0].image,specificationName:v==null?null:v.specName,amount:d.amount,price:u.price}})))}function m(d){C.value=!0,d==="credit-card"?i.value="credit-card":d==="transfer"&&(i.value="transfer")}async function N(){if(h.value=!1,L.value!=null)if(F.value===!0){if(D.value==null)return;k.value=(await nt({orderData:e.value,boughtItems:L.value})).data,M.replace({name:"completed",params:{orderId:k.value.serialNumber}}),await Promise.all(D.value.map(async d=>{await xe({id:d.id})})),w()}else M.replace({name:"cart"})}ae(async()=>{ie(),await Q(),j()});const x={iconBeforeText:De,text:"\u8A02\u55AE\u5DF2\u9001\u51FA\uFF01",color:"main-color",borderColor:"main-color",textInBtnOK:{text:"\u78BA\u5B9A",color:"match-color"}},$={iconBeforeText:Ee,text:"\u8A02\u55AE\u5931\u6557\uFF01",additionalText:"\u8ACB\u7A0D\u5F8C\u518D\u8A66\u4E00\u6B21",color:"main-product-color",borderColor:"main-product-color",textInBtnOK:{text:"\u78BA\u5B9A",color:"main-product-color"}};function le(){h.value=!0}function se(d){if(d==null){C.value=!1;return}i.value==="credit-card"?(e.value.cardOwner=d.cardOwner,e.value.cardNumber=d.cardNumber,e.value.cardValidDate=d.cardValidDate,e.value.cardValidCode=d.cardValidCode):i.value==="transfer"&&(e.value.bankCode=d.bankCode,e.value.bankAccount=d.bankAccount),C.value=!1}function ie(){if(e.value.name==null||e.value.name===""){M.replace({name:"checkout"});return}if(e.value.mobile==null||e.value.mobile===""){M.replace({name:"checkout"});return}(e.value.email==null||e.value.email==="")&&M.replace({name:"checkout"})}return(d,u)=>{const I=Ne,U=$e,v=Ce("FormKit");return l(),r(X,null,[n(ke,{target:"delivery"},{default:p(Y=>[n(v,{"form-class":"$reset",type:"form",actions:!1,"incomplete-message":" ",onSubmit:le,onSubmitInvalid:u[28]||(u[28]=()=>{})},{default:p(()=>[a("div",lt,[a("div",st," \u5171 "+V(Y.num)+" \u4EF6\u5546\u54C1\uFF5C\u7E3D\u91D1\u984D NT$ "+V(Y.total),1),a("div",it,[a("div",dt,[n(v,{modelValue:t(e).paymentType,"onUpdate:modelValue":u[19]||(u[19]=O=>t(e).paymentType=O),type:"radio",options:A,validation:"required","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165"}},{fieldset:p(O=>[rt,a("div",ct,[a("label",pt,[s(n(I,null,null,512),[[g,t(e).paymentType!=="credit-card"]]),s(n(U,null,null,512),[[g,t(e).paymentType==="credit-card"]]),s(a("input",{"onUpdate:modelValue":u[0]||(u[0]=o=>t(e).paymentType=o),class:"input-radio",value:"credit-card",type:"radio",name:"payment"},null,512),[[K,t(e).paymentType]]),H("\u4FE1\u7528\u5361\uFF0F\u91D1\u878D\u5361")]),n(z,null,{default:p(()=>[t(e).paymentType==="credit-card"?(l(),r("form",{key:0,class:"sub-content payment-credit-block",onSubmit:u[10]||(u[10]=G(()=>{},["prevent"]))},[a("button",{type:"button",class:"account-btn",onClick:u[1]||(u[1]=o=>m("credit-card"))}," \u9078\u53D6\u4FE1\u7528\u5361 "),n(v,{modelValue:t(e).cardNumber,"onUpdate:modelValue":u[3]||(u[3]=o=>t(e).cardNumber=o),type:"text",validation:"required|number|length:16, 16","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165",number:"\u8ACB\u8F38\u5165\u6578\u5B57",length:"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u5361\u865F"}},{wrapper:p(o=>[a("div",mt,[vt,s(a("input",{"onUpdate:modelValue":u[2]||(u[2]=c=>t(e).cardNumber=c),type:"text"},null,512),[[T,t(e).cardNumber]])])]),_:2},1032,["modelValue"]),n(v,{modelValue:t(e).cardOwner,"onUpdate:modelValue":u[5]||(u[5]=o=>t(e).cardOwner=o),type:"text",validation:"required:trim","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165"}},{wrapper:p(o=>[a("div",yt,[_t,s(a("input",{"onUpdate:modelValue":u[4]||(u[4]=c=>t(e).cardOwner=c),type:"text"},null,512),[[T,t(e).cardOwner]])])]),_:2},1032,["modelValue"]),n(v,{modelValue:t(e).cardValidDate,"onUpdate:modelValue":u[7]||(u[7]=o=>t(e).cardValidDate=o),type:"text",validation:"required:trim|matches:/^([0-9]{2})\\/([0-9]{2})$/","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165",matches:"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u65E5\u671F"}},{wrapper:p(o=>[a("div",bt,[Ft,s(a("input",{"onUpdate:modelValue":u[6]||(u[6]=c=>t(e).cardValidDate=c),type:"text",placeholder:"MM/YY"},null,512),[[T,t(e).cardValidDate]])])]),_:2},1032,["modelValue"]),n(v,{modelValue:t(e).cardValidCode,"onUpdate:modelValue":u[9]||(u[9]=o=>t(e).cardValidCode=o),type:"text",validation:"required:trim|number|length:3, 3","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165",number:"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u5B89\u5168\u78BC",length:"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u5B89\u5168\u78BC"}},{wrapper:p(o=>[a("div",ft,[Ct,s(a("input",{"onUpdate:modelValue":u[8]||(u[8]=c=>t(e).cardValidCode=c),type:"text",maxlength:"3"},null,512),[[T,t(e).cardValidCode]])])]),_:2},1032,["modelValue"])],32)):y("",!0)]),_:2},1024),a("label",gt,[s(n(I,null,null,512),[[g,t(e).paymentType!=="transfer"]]),s(n(U,null,null,512),[[g,t(e).paymentType==="transfer"]]),s(a("input",{"onUpdate:modelValue":u[11]||(u[11]=o=>t(e).paymentType=o),class:"input-radio",value:"transfer",type:"radio",name:"payment"},null,512),[[K,t(e).paymentType]]),H("\u9280\u884C\u8F49\u5E33")]),n(z,null,{default:p(()=>[t(e).paymentType==="transfer"?(l(),r("form",{key:0,class:"sub-content transfer-block",onSubmit:u[17]||(u[17]=G(()=>{},["prevent"]))},[a("button",{type:"button",class:"account-btn",onClick:u[12]||(u[12]=o=>m("transfer"))}," \u9078\u53D6\u9280\u884C\u5E33\u6236 "),n(v,{modelValue:t(e).bankCode,"onUpdate:modelValue":u[14]||(u[14]=o=>t(e).bankCode=o),type:"text",validation:"required|number|length:3, 3","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165",number:"\u8ACB\u8F38\u5165\u6578\u5B57",length:"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u9280\u884C\u4EE3\u78BC"}},{wrapper:p(o=>[a("div",ht,[Bt,s(a("input",{"onUpdate:modelValue":u[13]||(u[13]=c=>t(e).bankCode=c),type:"text"},null,512),[[T,t(e).bankCode]])])]),_:2},1032,["modelValue"]),n(v,{modelValue:t(e).bankAccount,"onUpdate:modelValue":u[16]||(u[16]=o=>t(e).bankAccount=o),type:"text",validation:"required|number|length:10, 14","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165",number:"\u8ACB\u8F38\u5165\u6578\u5B57",length:"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u9280\u884C\u4EE3\u78BC"}},{wrapper:p(o=>[a("div",kt,[Dt,s(a("input",{"onUpdate:modelValue":u[15]||(u[15]=c=>t(e).bankAccount=c),type:"text"},null,512),[[T,t(e).bankAccount]])])]),_:2},1032,["modelValue"])],32)):y("",!0)]),_:2},1024),a("label",Et,[s(n(I,null,null,512),[[g,t(e).paymentType!=="cash-on-delivery"]]),s(n(U,null,null,512),[[g,t(e).paymentType==="cash-on-delivery"]]),s(a("input",{"onUpdate:modelValue":u[18]||(u[18]=o=>t(e).paymentType=o),class:"input-radio",value:"cash-on-delivery",type:"radio",name:"payment"},null,512),[[K,t(e).paymentType]]),H("\u8CA8\u5230\u4ED8\u6B3E")])])]),_:1},8,["modelValue"])]),a("div",Vt,[n(v,{modelValue:t(e).deliveryType,"onUpdate:modelValue":u[27]||(u[27]=O=>t(e).deliveryType=O),options:q,type:"radio",validation:"required","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165"}},{fieldset:p(O=>[At,a("div",xt,[a("label",It,[s(n(I,null,null,512),[[g,t(e).deliveryType!=="home-delivery"]]),s(n(U,null,null,512),[[g,t(e).deliveryType==="home-delivery"]]),s(a("input",{"onUpdate:modelValue":u[20]||(u[20]=o=>t(e).deliveryType=o),class:"input-radio",value:"home-delivery",type:"radio",name:"delivery"},null,512),[[K,t(e).deliveryType]]),H("\u5B85\u914D")]),n(z,null,{default:p(()=>[t(e).deliveryType==="home-delivery"?(l(),r("form",{key:0,class:"sub-content delivery-block",onSubmit:u[25]||(u[25]=G(()=>{},["prevent"]))},[n(v,{modelValue:t(e).county,"onUpdate:modelValue":u[22]||(u[22]=o=>t(e).county=o),validation:"required","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165"}},{wrapper:p(o=>[s(a("select",{"onUpdate:modelValue":u[21]||(u[21]=c=>t(e).county=c),class:"delivery-dropdown",name:"county"},[Tt,(l(),r(X,null,oe(B,(c,de)=>a("option",{key:`county-${de}`,value:c},V(c),9,wt)),64))],512),[[Fe,t(e).county]])]),_:2},1032,["modelValue"]),n(v,{modelValue:t(e).address,"onUpdate:modelValue":u[24]||(u[24]=o=>t(e).address=o),type:"text",validation:"required:trim","validation-visibility":"live","validation-messages":{required:"\u9019\u662F\u5FC5\u8981\u8F38\u5165"}},{wrapper:p(o=>[s(a("input",{"onUpdate:modelValue":u[23]||(u[23]=c=>t(e).address=c),placeholder:"\u8ACB\u8F38\u5165\u8A73\u7D30\u5730\u5740...",class:"address-input",type:"text",name:"address"},null,512),[[T,t(e).address]])]),_:2},1032,["modelValue"])],32)):y("",!0)]),_:2},1024),a("label",St,[s(n(I,null,null,512),[[g,t(e).deliveryType!=="convenience-store"]]),s(n(U,null,null,512),[[g,t(e).deliveryType==="convenience-store"]]),s(a("input",{"onUpdate:modelValue":u[26]||(u[26]=o=>t(e).deliveryType=o),class:"input-radio",value:"convenience-store",type:"radio",name:"delivery"},null,512),[[K,t(e).deliveryType]]),H("\u8D85\u5546\u53D6\u8CA8")]),t(e).deliveryType==="convenience-store"?(l(),r("div",$t,qt)):y("",!0)])]),_:1},8,["modelValue"])])]),a("div",Lt,[n(fe,{type:"submit",class:"btn",content:S})])])]),_:2},1024)]),_:1}),(l(),P(W,{to:"body"},[n(z,null,{default:p(()=>[t(h)&&t(F)?(l(),P(ee,{key:0,"text-in-dialog":x,onCloseInfoDialog:N})):y("",!0)]),_:1})])),(l(),P(W,{to:"body"},[n(z,null,{default:p(()=>[t(h)&&!t(F)?(l(),P(ee,{key:0,"text-in-dialog":$,onCloseInfoDialog:N})):y("",!0)]),_:1})])),t(C)?(l(),P(Ze,{key:0,target:t(i),onCloseDialog:se},null,8,["target"])):y("",!0)],64)}}});const Qt=ne(Nt,[["__scopeId","data-v-a42543a9"]]);export{Qt as default};
